<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/images/icon.png">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		
		<link href="../_app/immutable/assets/0.iAhW6_v3.css" rel="stylesheet">
		<link href="../_app/immutable/assets/5.CIQj84rK.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.ek_NoGGp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Byb9w9Ax.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/SWu5V7ta.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bw2Lo1XO.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.BEmJFeDD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/21pSE9mY.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C5Z4FKd1.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DmA_CMWa.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C5XtRKzK.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.BhNARJ_G.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DuACExjB.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DOGHnPB-.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/NmhfbsVq.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/5.ByWbaATj.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CwwknbQU.js">
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="wrapper svelte-jukz7s"><header class="svelte-2vm4mj"><div class="container svelte-2vm4mj"><a class="hover logo svelte-2vm4mj" href="/"><img src="/images/icon2.jpg" alt="icon" class="svelte-2vm4mj"> <h1 class="svelte-2vm4mj">haya1007.com</h1></a> <nav class="svelte-2vm4mj"><ul class="svelte-2vm4mj"><!--[--><li><a class="hover-line hover" href="/works">works</a></li><li><a class="hover-line hover" href="/about">about</a></li><li><a class="hover-line hover" href="/blog">blog</a></li><!--]--></ul></nav></div></header><!----> <!----><!----><article><div class="base svelte-zmf29k"><div class="container svelte-zmf29k"><div class="button hover svelte-zmf29k"><a href="/blog">back</a></div> <div class="top-content svelte-zmf29k"><h1 class="title svelte-zmf29k">BINDを使ったDNSサーバーの作成</h1> <time class="date svelte-zmf29k">2025-04-27</time></div> <img class="thumbnail svelte-zmf29k" src="/images/posts/post2.png" alt=""> <div class="main-content svelte-zmf29k"><!----><p>CentOS Stream 9 でローカル内の名前解決をできるようにするDNSサーバーを建てる。<br></p> <h2>アドレス</h2> <table><thead><tr><th>サーバー種</th><th>IPアドレス</th><th>FQDN</th></tr></thead><tbody><tr><td>DGW</td><td>192.168.1.0</td><td></td></tr><tr><td>DNS</td><td>192.168.1.10</td><td>dns.haya1007.com</td></tr><tr><td>WEB</td><td>192.168.1.20</td><td>web.haya1007.com</td></tr></tbody></table> <br> <h2>BINDのインストール</h2> <pre class="language-undefined"><!----><code class="language-undefined">sudo dnf install bind bind-chroot</code><!----></pre> <p>bind-chrootは/etc/named/chrootをルート「/」にすることで、BINDを侵害されてもアクセスを制限できる。</p> <br> BINDの設定は「/etc/named.conf」で行い、ゾーンファイルを「/var/named/」に作る。 <br> <h3>/etc/named.confの設定</h3> <pre class="language-undefined"><!----><code class="language-undefined">//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//

options &#123;
        listen-on port 53 &#123; 127.0.0.1; 192.168.1.10; 192.168.1.0; &#125;;
        listen-on-v6 port 53 &#123; ::1; &#125;;
        directory       &quot;/var/named&quot;;
        dump-file       &quot;/var/named/data/cache_dump.db&quot;;
        statistics-file &quot;/var/named/data/named_stats.txt&quot;;
        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
        secroots-file   &quot;/var/named/data/named.secroots&quot;;
        recursing-file  &quot;/var/named/data/named.recursing&quot;;
        allow-query     &#123; 192.168.1.0/24; &#125;;

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;&lt;/code&gt;

        dnssec-validation yes;

        managed-keys-directory &quot;/var/named/dynamic&quot;;
        geoip-directory &quot;/usr/share/GeoIP&quot;;

        pid-file &quot;/run/named/named.pid&quot;;
        session-keyfile &quot;/run/named/session.key&quot;;

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include &quot;/etc/crypto-policies/back-ends/bind.config&quot;;
&#125;;

logging &#123;
        channel default_debug &#123;
                file &quot;data/named.run&quot;;
                severity dynamic;
        &#125;;
&#125;;
                                                                                                                             
zone &quot;.&quot; IN &#123;                                                                                                                
        type hint;                                                                                                           
        file &quot;named.ca&quot;;                                                                                                     
&#125;;                                                                                                                           
                                                                                                                             
zone &quot;haya1007.com&quot; IN &#123;                                                                                                     
        type master;                                                                                                         
        file &quot;forward.example.com&quot;;                                                                                         
        allow-update &#123; none; &#125;;                                                                                              
&#125;;                                                                                                                           
                                                                                                                             
zone &quot;1.168.192.in-addr.arpa&quot; IN &#123;                                                                                           
        type master;                                                                                                         
        file &quot;reverse.192.168.1&quot;;                                                                                            
        allow-update &#123; none; &#125;;                                                                                              
&#125;;                                                                                                                           
                                                                                                                             
                                                                                                                             
                                                                                                                             
include &quot;/etc/named.rfc1912.zones&quot;;                                                                                          
include &quot;/etc/named.root.key&quot;; &lt;/code&gt;&lt;/pre&gt;</code><!----></pre> <br> <h3>/var/named/forward.example.com</h3> <pre class="language-undefined"><!----><code class="language-undefined">$TTL    86400
@       IN      SOA     dns.example.com. root.example.com. (
                                        2025042701 ; serial
                                        3600       ; refresh
                                        900        ; retry
                                        604800     ; expire
                                        86400 )    ; minimum
        IN      NS      dns.example.com.
dns     IN      A       192.168.1.10
web     IN      A       192.168.1.20</code><!----></pre> <br> <h3>/var/named/reverse.192.168.1</h3> <pre class="language-undefined"><!----><code class="language-undefined">$TTL    86400
@       IN      SOA     dns.example.com. root.example.com. (
                                        2025042701 ; serial
                                        3600       ; refresh
                                        900        ; retry
                                        604800     ; expire
                                        86400 )    ; minimum
        IN      NS      dns.example.com.
10      IN      PTR     dns.example.com.
20      IN      PTR     web.example.com.</code><!----></pre> <br> <h2>設定の確認とBINDの起動</h2> <h3>設定の確認</h3> <pre class="language-undefined"><!----><code class="language-undefined"># named.confの確認
sudo named-checkconf /etc/named.conf

# forward.haya1007.comとreverse.192.168.1の確認
sudo named-checkzone example.com /var/named/forward.example.com
sudo named-checkzone 1.168.192.in-addr.arpa /var/named/reverse.192.168.1</code><!----></pre> <p>※エラーが出たら修正する。<br></p> <pre class="language-undefined"><!----><code class="language-undefined">sudo chown named:named /var/named/forward.example.com
sudo chown named:named /var/named/reverse.192.168.1
sudo chmod 640 /var/named/forward.example.com
sudo chmod 640 /var/named/reverse.192.168.1</code><!----></pre> <br> <h3>BINDの起動</h3> <pre class="language-undefined"><!----><code class="language-undefined">sudo systemctl enable --now named-chroot</code><!----></pre> <pre class="language-undefined"><!----><code class="language-undefined">sudo systemctl status named-chroot</code><!----></pre> <p>もしrunningじゃなかったら、エラーを見て確認する。</p> <br> <h3>firewalldの設定</h3> <pre class="language-undefined"><!----><code class="language-undefined">vim /etc/resolv.conf</code><!----></pre> <pre class="language-undefined"><!----><code class="language-undefined"># Generated by NetworkManager
nameserver 192.168.3.10
domain example.com</code><!----></pre> <br> <h2>Windowsの設定（ホストPC）</h2> <p>WindowsでDNSサーバーを設定する方法</p> <br> <p>・コントロールパネル→ネットワークとインターネット→ネットワークと共有センター</p> <p>で、自身のNWのプロパティを開く</p> <br> <p>・インターネットプロトコルバージョン4 (TCP/IPv4)のプロパティを開き、優先DNSに192.168.1.10を設定する。</p> <p>コマンドプロンプトで</p> <pre class="language-undefined"><!----><code class="language-undefined">nslookup web.example.com</code><!----></pre> <p>で192.168.1.20が返ってくることを確認。</p> <br> <p>もし返ってこない場合、IPv6が有効になっていたり、Windows Defenderのファイヤーウォールで53番ポートとのやり取りが禁止されている可能性がある。</p><!----></div> <div class="button hover svelte-zmf29k"><a href="/blog">back</a></div></div></div></article><!----><!----> <footer class="svelte-1swrjmz"><div class="base svelte-1swrjmz"><div class="container svelte-1swrjmz"><a class="hover" href="/"><img src="/images/icon.png" alt="" class="svelte-1swrjmz"></a> <div class="footer-nav svelte-1swrjmz"><nav class="global svelte-1swrjmz"><ul class="svelte-1swrjmz"><!--[--><li><a class="hover" href="/works">works</a></li><li><a class="hover" href="/about">about</a></li><li><a class="hover" href="/blog">blog</a></li><!--]--></ul></nav> <nav class="sns svelte-1swrjmz"><ul class="svelte-1swrjmz"><!--[--><li><a href="https://www.youtube.com/@ekko-hy" target="_blank"><img class="hover svelte-1swrjmz" src="/images/sns/youtube.svg" alt="Youtube"></a></li><li><a href="https://x.com/pippipipiip" target="_blank"><img class="hover svelte-1swrjmz" src="/images/sns/x.svg" alt="X"></a></li><li><a href="https://github.com/haya1007" target="_blank"><img class="hover svelte-1swrjmz" src="/images/sns/github.svg" alt="GitHub"></a></li><!--]--></ul></nav></div></div></div> <p class="copyright svelte-1swrjmz">Copyright <span class="svelte-1swrjmz">©</span> haya1007 all rights reserved.</p></footer><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_gk4jbm = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.ek_NoGGp.js"),
						import("../_app/immutable/entry/app.BEmJFeDD.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
